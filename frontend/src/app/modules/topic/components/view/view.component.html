<div class="list-page {{theme}}">
    <div class="list" *ngIf="loading">
        <div class="list-header">
            <span>
                <app-loading height="52px" width="400px"></app-loading>
            </span>
            <app-loading height="40px" width="200px"></app-loading>
        </div>
        <div class="list-body">
            <div class="posts">
                <div class="user-card">
                    <app-loading appa="circle"></app-loading>
                    <div class="text">
                        <p>
                            <app-loading height="25px" width="70px"></app-loading>
                        </p>
                        <small><app-loading height="20px" width="40px"></app-loading></small>
                    </div>
                </div>
                <div class="post-main">
                    <div class="post-body">
                        <div class="post-header">
                            <p><app-loading height="25px" width="80px"></app-loading></p>
                        </div>
                        <p class="content"><app-loading height="150px" width="100%"></app-loading></p>
                    </div>
                </div>
            </div>
            <div class="posts" *ngFor="let _ of [0,1,2,3]">
                <div class="user-card">
                    <app-loading appa="circle"></app-loading>
                    <div class="text">
                        <p><app-loading height="25px" width="70px"></app-loading></p>
                        <small><app-loading height="20px" width="40px"></app-loading></small>
                    </div>
                </div>
                <div class="post-main">
                    <div class="post-body">
                        <div class="post-header">
                            <p><app-loading height="25px" width="70px"></app-loading></p>
                        </div>
                        <p class="content"><app-loading height="150px" width="100%"></app-loading></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="list-footer">
            <app-loading height="35px" width="180px"></app-loading>
        </div>
    </div>

    <div class="list" *ngIf="!loading">
        <div class="list-header">
            <h1 routerLink="/category/{{listPosts.category.id}}">{{listPosts.category.title | capitalize}}</h1>
            <h2>{{listPosts.topic.title | capitalize}}</h2>
            <a *ngIf="listPosts.can_post" routerLink="/post/create">Create new Post</a>
        </div>
        <a routerLink="/topic/{{listPosts.topic.id}}/poll/create" *ngIf="listPosts.can_poll">Create Poll</a>
        <div *ngIf="listPosts.poll">
            <div *ngIf=" !showResults">
                <h5>Poll: {{listPosts.poll.name}}</h5> <a routerLink="/topic/{{listPosts.topic.id}}/poll/edit"
                    *ngIf="listPosts.poll.can_edit">Edit</a>
                <div class="poll-options" *ngFor="let option of listPosts.poll.options">
                    <input type="radio" name="poll" id="option-{{option.id}}" [(ngModel)]="vote" [value]="option.id"
                        class="option-radio">
                    <label for="option-{{option.id}}" class="option-label">{{option.option}}</label>
                </div>
                <button (click)="onVote()" [disabled]="vote == null">Vote</button> 
                <button (click)="onShowPollResults()">Show results</button>
            </div>
            <div *ngIf="pollResults && showResults">
                <h5>Poll: {{pollResults.name}}</h5>

                <div class="poll-vote" [class]="option.voted ? 'voted' : '' "
                    *ngFor="let option of pollResults.options">
                    {{option.option}} : {{option.votes}}
                </div>
                <button (click)="onShowPollResults()" *ngIf="listPosts.poll.can_vote">Back to vote</button>
            </div>

            Finishes: {{listPosts.poll.finish_date | date }}
        </div>



        <div class="list-body">
            <div *ngIf="listPosts.topic.user" class="posts">
                <div class="user-card">
                    <app-avatar [user]="listPosts.topic.user"></app-avatar>
                    <div class="text">
                        <a routerLink="/user/profile/{{listPosts.topic.user.id}}">{{listPosts.topic.user.nick}}</a>
                        <small>{{listPosts.topic.user.rol}}</small>
                    </div>
                </div>
                <div class="post-main">
                    <div class="post-body">
                        <div class="post-header">
                            <p>{{listPosts.topic.created_at | date}}</p>
                            <div *ngIf="listPosts.can_edit" class="edit-buttons">
                                <button type="button">Edit</button>
                                <button type="button">Delete</button>
                            </div>
                        </div>
                        <p class="content" [innerHTML]="listPosts.topic.content"></p>
                    </div>
                    <div *ngIf="listPosts.topic.created_at != listPosts.topic.updated_at" class="post-footer">
                        <p>{{listPosts.topic.updated_at | date}}</p>
                    </div>
                </div>
            </div>
            <div class="posts" *ngFor="let post of listPosts.posts">
                <div class="user-card">
                    <app-avatar [user]="post.user"></app-avatar>
                    <div class="text">
                        <a routerLink="/user/profile/{{post.user.id}}">{{post.user.nick}}</a>
                        <small>{{post.user.rol}}</small>
                    </div>
                </div>
                <div class="post-main">
                    <div class="post-body">
                        <div class="post-header">
                            <p>{{post.created_at | date}}</p>
                            <div *ngIf="post.can_edit" class="edit-buttons">
                                <button type="button">Edit</button>
                                <button type="button" (click)="deletePost(post.id)">Delete</button>
                            </div>
                        </div>
                        <p class="content" [innerHTML]="post.content"></p>
                    </div>
                    <div *ngIf="post.created_at != post.updated_at" class="post-footer">
                        <p>{{post.updated_at | date}}</p>
                    </div>
                </div>
            </div>
            <div class="editor-parent" *ngIf="listPosts.can_post">
                <div class="editor">
                    <angular-editor id="editor" [(ngModel)]="content" [config]="editorConfig"></angular-editor>
                </div>
                <input type="submit" [disabled]="content.length == 0 || content.length > 10_000" class="btn btn-primary"
                    (click)="onSubmit()">
                <div *ngIf="error != ''" class="error">
                    <fa-icon [icon]="['fas', 'triangle-exclamation']"></fa-icon> {{error}}
                </div>
            </div>
        </div>
        <div class="list-footer">
            <app-pagination [current_page]="listPosts.page.current" [last_page]="listPosts.page.last"
                (changePage)="changePage($event)"></app-pagination>
        </div>
    </div>
</div>