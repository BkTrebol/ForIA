<div class="list-page {{theme}}">
    <div class="list">
        <div class="list-header">
            <h1 *ngIf="loading">Private Message</h1>
            <!-- <h1 *ngIf="!loading">{{privateMessage?.message?.title}}</h1> -->
        </div>
        <h4 *ngIf="loading"><fa-icon [icon]="['fas', 'spinner']" [pulse]="true"></fa-icon> Loading ...</h4>
        <div *ngIf="!loading">
            <button routerLink="/private-message/reply/{{pmId}}">Reply</button>
            <ng-container *ngIf="privateMessageList">
                <div *ngIf="privateMessageList.message.hasOwnProperty('content')">
                    <ng-container *ngTemplateOutlet="message; context:{pm: privateMessageList.message}"></ng-container>
                    <h3>Historial de missatges</h3>
                    <hr/><br>
                </div>

                <div *ngFor="let pm of privateMessageList.thread">
                    <ng-container *ngTemplateOutlet="message; context: {pm: pm}"></ng-container>
                </div>

                <div class="editor-parent">
                    <div class="editor">
                        <input type="text" [(ngModel)]="reply.title">
                        <angular-editor id="editor" [(ngModel)]="reply.content" [config]="editorConfig"></angular-editor>
                    </div>
                    <input type="submit" [disabled]="reply.content.length == 0 || reply.content.length > 10_000" class="btn btn-primary"
                        (click)="onSubmit()">
                    <div *ngIf="error != ''" class="error">
                        <fa-icon [icon]="['fas', 'triangle-exclamation']"></fa-icon> {{error}}
                    </div>
                </div>

                <div class="list-footer">
                   <app-pagination [current_page]="privateMessageList.current_page" [last_page]="privateMessageList.last_page"
                   (changePage)="changePage($event)">

                   </app-pagination>
                </div>
            </ng-container>
            <br>


        </div>
    </div>
</div>

<ng-template #message let-pm="pm">
    <div class="post">
        <div class="body">
            <h5>{{pm.title}}</h5>
            <p>From: <a routerLink="/user/profile/{{pm.sender.id}}">{{pm.sender.nick}}</a> on {{pm.created_at | date}}
            </p>
            <hr>
            <p class="content" [innerHTML]="pm.content">
            </p>
        </div>
        <div class="avatar">
            <app-avatar [user]="pm.sender"></app-avatar>
            <a routerLink="/user/profile/{{pm.sender.id}}">{{pm.sender.nick}}</a>
            <p>{{pm.sender.role}}</p>
        </div>
    </div>
</ng-template>